<!DOCTYPE html>
<html lang="en" data-dark="false">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!--
  put your analytics (e.g. Google Analytics) tracking code here
-->

  <!--
  put your search engine verification (e.g. Google Search Console) tag here
-->

  


























<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Visualizing Patient Origin in North Carolina Using Zipcode in R | Tianyi Liu</title>

<link rel="icon" href="/images/icon.png">

<meta name="title" content="Visualizing Patient Origin in North Carolina Using Zipcode in R">
<meta name="description" content="My Works &amp; Thoughts. A website that introduces you to my works, my thoughts, my friends and colleagues, and more.">

<meta property="og:title" content="Visualizing Patient Origin in North Carolina Using Zipcode in R">
<meta property="og:site_title" content="Tianyi Liu">
<meta property="og:description" content="My Works &amp; Thoughts. A website that introduces you to my works, my thoughts, my friends and colleagues, and more.">
<meta property="og:url" content="">
<meta property="og:image" content="/images/share.jpg">
<meta property="og:locale" content="en_US">

<meta property="twitter:title" content="Visualizing Patient Origin in North Carolina Using Zipcode in R">
<meta property="twitter:description" content="My Works &amp; Thoughts. A website that introduces you to my works, my thoughts, my friends and colleagues, and more.">
<meta property="twitter:url" content="">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="/images/share.jpg">


  <meta name="author" content="tianyi-liu">
  <meta property="og:type" content="article">
  <meta property="og:updated_time" content="2023-10-04T02:25:38+00:00">
  <meta property="article:published_time" content="2023-10-02T00:00:00+00:00">
  <meta property="article:modified_time" content="2023-10-04T02:25:38+00:00">
  <meta name="revised" content="2023-10-04T02:25:38+00:00">


<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "BlogPosting",
      "author": { "@type": "Person", "name": "Visualizing Patient Origin in North Carolina Using Zipcode in R" },
      "datePublished": "2023-10-02T00:00:00+00:00",
      "dateModified": "2023-10-04T02:25:38+00:00",
    
    "name": "Visualizing Patient Origin in North Carolina Using Zipcode in R",
    "description": "My Works & Thoughts. A website that introduces you to my works, my thoughts, my friends and colleagues, and more.",
    "headline": "Visualizing Patient Origin in North Carolina Using Zipcode in R",
    "publisher": {
      "@type": "Organization",
      "logo": { "@type": "ImageObject", "url": "/images/icon.png" }
    },
    "url": ""
  }
</script>

<link rel="alternate" type="application/rss+xml" href="/feed.xml">

  <!-- Google Fonts -->
<!-- automatically get url from fonts used in theme file -->

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?display=swap&&family=Aleo:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600&amp;family=Carme:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600&amp;family=Nunito:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600&amp;family=Roboto+Mono:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600" rel="stylesheet">

<!-- Font Awesome icons (load asynchronously due to size) -->

<link href="https://use.fontawesome.com/releases/v6.3.0/css/all.css" rel="preload" as="style" onload="this.onload = null; this.rel = 'stylesheet';">
<noscript>
  <link href="https://use.fontawesome.com/releases/v6.3.0/css/all.css" rel="stylesheet">
</noscript>

  <!-- third party styles -->
<!-- https://stylishthemes.github.io/Syntax-Themes/pygments/ -->
<link href="https://cdn.jsdelivr.net/gh/StylishThemes/Syntax-Themes/pygments/css-github/pygments-tomorrow-night-eighties.css" rel="stylesheet">

<!-- include all sass in styles folder -->


  
    <link href="/_styles/-theme.css" rel="stylesheet">
  

  
    <link href="/_styles/alert.css" rel="stylesheet">
  

  
    <link href="/_styles/all.css" rel="stylesheet">
  

  
    <link href="/_styles/anchor.css" rel="stylesheet">
  

  
    <link href="/_styles/background.css" rel="stylesheet">
  

  
    <link href="/_styles/body.css" rel="stylesheet">
  

  
    <link href="/_styles/bold.css" rel="stylesheet">
  

  
    <link href="/_styles/button.css" rel="stylesheet">
  

  
    <link href="/_styles/card.css" rel="stylesheet">
  

  
    <link href="/_styles/checkbox.css" rel="stylesheet">
  

  
    <link href="/_styles/citation.css" rel="stylesheet">
  

  
    <link href="/_styles/code.css" rel="stylesheet">
  

  
    <link href="/_styles/cols.css" rel="stylesheet">
  

  
    <link href="/_styles/dark-toggle.css" rel="stylesheet">
  

  
    <link href="/_styles/feature.css" rel="stylesheet">
  

  
    <link href="/_styles/figure.css" rel="stylesheet">
  

  
    <link href="/_styles/float.css" rel="stylesheet">
  

  
    <link href="/_styles/font.css" rel="stylesheet">
  

  
    <link href="/_styles/footer.css" rel="stylesheet">
  

  
    <link href="/_styles/form.css" rel="stylesheet">
  

  
    <link href="/_styles/grid.css" rel="stylesheet">
  

  
    <link href="/_styles/header.css" rel="stylesheet">
  

  
    <link href="/_styles/heading.css" rel="stylesheet">
  

  
    <link href="/_styles/highlight.css" rel="stylesheet">
  

  
    <link href="/_styles/icon.css" rel="stylesheet">
  

  
    <link href="/_styles/image.css" rel="stylesheet">
  

  
    <link href="/_styles/link.css" rel="stylesheet">
  

  
    <link href="/_styles/list.css" rel="stylesheet">
  

  
    <link href="/_styles/main.css" rel="stylesheet">
  

  
    <link href="/_styles/paragraph.css" rel="stylesheet">
  

  
    <link href="/_styles/portrait.css" rel="stylesheet">
  

  
    <link href="/_styles/post-excerpt.css" rel="stylesheet">
  

  
    <link href="/_styles/post-info.css" rel="stylesheet">
  

  
    <link href="/_styles/post-nav.css" rel="stylesheet">
  

  
    <link href="/_styles/quote.css" rel="stylesheet">
  

  
    <link href="/_styles/rule.css" rel="stylesheet">
  

  
    <link href="/_styles/search-box.css" rel="stylesheet">
  

  
    <link href="/_styles/search-info.css" rel="stylesheet">
  

  
    <link href="/_styles/section.css" rel="stylesheet">
  

  
    <link href="/_styles/table.css" rel="stylesheet">
  

  
    <link href="/_styles/tags.css" rel="stylesheet">
  

  
    <link href="/_styles/textbox.css" rel="stylesheet">
  

  
    <link href="/_styles/tooltip.css" rel="stylesheet">
  

  
    <link href="/_styles/util.css" rel="stylesheet">
  


<!-- include all css in styles folder -->



  <!-- third party scripts -->
<script src="https://unpkg.com/@popperjs/core@2" defer></script>
<script src="https://unpkg.com/tippy.js@6" defer></script>
<script src="https://unpkg.com/mark.js@8" defer></script>

<!-- include all js in scripts folder -->


  <script src="/_scripts/anchors.js"></script>

  <script src="/_scripts/dark-mode.js"></script>

  <script src="/_scripts/fetch-tags.js"></script>

  <script src="/_scripts/search.js"></script>

  <script src="/_scripts/site-search.js"></script>

  <script src="/_scripts/tooltip.js"></script>


</head>

  <body>
    







<header class="background" style="--image: url('/images/header.jpg')" data-dark="true">
  <a href="/" class="home">
    
      <span class="logo">
        
          <img src="/images/logo.png" alt="logo">
        
      </span>
    
    
      <span class="title" data-tooltip="Home">
        
          <span>Tianyi Liu</span>
        
        
          <span>My Works &amp; Thoughts</span>
        
      </span>
    
  </a>

  <input class="nav-toggle" type="checkbox" aria-label="show/hide nav">

  <nav>
    
    
      
        <a href="/research/" data-tooltip="Published works">
          Research
        </a>
      
    
      
        <a href="/projects/" data-tooltip="Software, datasets, and more">
          Projects
        </a>
      
    
      
        <a href="/team/" data-tooltip="About my colleagues and close friends and what they are up to">
          Colleagues/Friends
        </a>
      
    
      
        <a href="/blog/" data-tooltip="Musings and miscellany">
          Blog
        </a>
      
    
      
        <a href="/contact/" data-tooltip="Email, address, and location">
          Contact
        </a>
      
    
  </nav>
</header>

    <main>
      <!--
  modify main content of page:
  - add section breaks
  - attach section properties
  - wrap each table in div to allow for scrolling
  - filter out blank sections
-->








  
  
  

  <section class="background" data-size="page">
    <h1 class="center">Visualizing Patient Origin in North Carolina Using Zipcode in R</h1>

<div class="post-info">
  
    
    
      

<div class="portrait-wrapper">
  <a href="/members/tianyi-liu.html" class="portrait" data-style="tiny" aria-label="Tianyi Liu">
    <img src="/images/headshot.jpg" class="portrait-image" alt="member portrait" loading="lazy" onerror="this.src = '/images/fallback.svg'; this.onerror = null;">

    
      <span class="portrait-text">
        
          <span class="portrait-name">
            Tianyi Liu
          </span>
        

        
      </span>
    
  </a>
</div>

    
  

  
  

  
    <span data-tooltip="Originally published on">
      <i class="icon fa-regular fa-calendar"></i>
      <span>October 02, 2023</span>
    </span>
  

  
    <span data-tooltip="Last updated on">
      <i class="icon fa-solid fa-clock-rotate-left"></i>
      <span>October 04, 2023</span>
    </span>
  
</div>


  


  <div class="tags" data-link="/blog">
    
      <a href="/blog?search=%22tag:%20visualization%22" class="tag" data-tooltip='Show items with the tag "visualization"'>
        visualization
      </a>
    
      <a href="/blog?search=%22tag:%20R%22" class="tag" data-tooltip='Show items with the tag "R"'>
        R
      </a>
    
      <a href="/blog?search=%22tag:%20ggplot2%22" class="tag" data-tooltip='Show items with the tag "ggplot2"'>
        ggplot2
      </a>
    
      <a href="/blog?search=%22tag:%20zipcode%22" class="tag" data-tooltip='Show items with the tag "zipcode"'>
        zipcode
      </a>
    
      <a href="/blog?search=%22tag:%20geography%22" class="tag" data-tooltip='Show items with the tag "geography"'>
        geography
      </a>
    
      <a href="/blog?search=%22tag:%20NC%22" class="tag" data-tooltip='Show items with the tag "NC"'>
        NC
      </a>
    
      <a href="/blog?search=%22tag:%20tutorial%22" class="tag" data-tooltip='Show items with the tag "tutorial"'>
        tutorial
      </a>
    
  </div>
  </section>

  
  
  

  <section class="background" data-size="page">
    <!--
  background: ;
  dark: ;
  size: ;
-->


<p>Do you want to plot something like this? Wonder how you could do it in R?</p>

<p><img src="/images/patient_origin_map.jpg" alt="Patient Count by NC County"></p>

<p>In this article, we will go over in detail the steps for plotting the density of
patients from each North Carolina (NC) county by their zipcode using <code class="language-plaintext highlighter-rouge">ggplot</code> in
<code class="language-plaintext highlighter-rouge">R</code>, a.k.a. the plot above. We have 191 patients from 57 unique zipcodes.
Since the patient data are protected, the full data is not presented here. You can find the
zipcode data by <a href="https://docs.google.com/spreadsheets/d/1wZhaS7GGySFX62BjRGlKjSMf0AyekCGeiJEjaZaLUBA/edit?usp=sharing">clicking here</a>.</p>

<p>The main workflow here it to merge the data frame containing patient count by county with
that of the map coordinates of each NC county. Some data wrangling is needed to translate
patient zipcode to county names before the final merging of the data frames. Some contents
of this blog post inspired by <a href="https://www.peterhaschke.com/r/2013/12/05/NCmaps.html">this post</a>
by Peter Haschke.</p>

<p>We start by loading the following packages in R:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w"> </span><span class="c1"># data wrangling</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w"> </span><span class="c1"># string object manipulation</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span><span class="w"> </span><span class="c1"># the package of the famed pipe operator</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w"> </span><span class="c1"># data plotting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span><span class="w"> </span><span class="c1"># this allows us to extract NC map</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">zipcodeR</span><span class="p">)</span><span class="w"> </span><span class="c1"># for zipcode metadata</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span><span class="w"> </span><span class="c1"># not necessary - allows us to set ggplot themes more easily</span><span class="w">
</span></code></pre></div></div>

<p>Suppose that the patient data is stored in a <a href="https://tibble.tidyverse.org/">tibble</a> named <code class="language-plaintext highlighter-rouge">clean_df</code>, where there is a column <code class="language-plaintext highlighter-rouge">zip</code> that contains all the zipcodes:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">clean_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">zip</span><span class="p">),</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 5 × 1
   zip  
   &lt;fct&gt;
 1 28376
 2 28376
 3 27278
 4 28315
 5 27616
</code></pre></div></div>
<p>Now, we count up the number of patients from each zipcode using the <code class="language-plaintext highlighter-rouge">summarise()</code>
function:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">zip_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">clean_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">zip</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">zip_sum</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 5 × 2
   zip       n
   &lt;fct&gt; &lt;int&gt;
 1 24112     1
 2 27025     2
 3 27105     1
 4 27208     1
 5 27215     8
</code></pre></div></div>
<p>After this, we can map the patient zipcodes to their metadata</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">zip_info</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reverse_zipcode</span><span class="p">(</span><span class="n">zip_sum</span><span class="o">$</span><span class="n">zip</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>A sample of this <code class="language-plaintext highlighter-rouge">zip_info</code> data frame should look like this (by calling <code class="language-plaintext highlighter-rouge">head(zip_info, 2)</code>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 2 × 24
  zipcode zipcode_type major_city    post_office_city  common_city_list county  state   lat   lng
  &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;         &lt;chr&gt;                       &lt;blob&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 27025   Standard     Madison       Madison, NC             &lt;raw 19 B&gt; Rockin… NC     36.4 -80  
2 27105   Standard     Winston Salem Winston Salem, NC       &lt;raw 25 B&gt; Forsyt… NC     36.2 -80.2
</code></pre></div></div>
<p>The only conlumns we want are <code class="language-plaintext highlighter-rouge">zipcode</code> and <code class="language-plaintext highlighter-rouge">county</code>. We also rename <code class="language-plaintext highlighter-rouge">zipcode</code> to <code class="language-plaintext highlighter-rouge">zip</code>
to be consistent with the variable name in <code class="language-plaintext highlighter-rouge">zip_sum</code>:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">zip_sub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">zip_info</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">zipcode</span><span class="p">,</span><span class="w"> </span><span class="n">county</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">zip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zipcode</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Next, we begin by extracting the NC county map coordinates from the <code class="language-plaintext highlighter-rouge">map</code> package,
and save it in a data frame for plotting later:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">map_data</span><span class="p">(</span><span class="s2">"county"</span><span class="p">)</span><span class="w">
</span><span class="n">nc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"north carolina"</span><span class="p">)</span><span class="w"> </span><span class="c1"># subset the data to NC county coordinates</span><span class="w">
</span></code></pre></div></div>
<p>We can check the head of <code class="language-plaintext highlighter-rouge">nc</code> as well (<code class="language-plaintext highlighter-rouge">head(nc, 2)</code>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>long      lat group order         region subregion
54915 -79.53800 35.84424  1857 54915 north carolina  alamance
54916 -79.54372 35.89008  1857 54916 north carolina  alamance
</code></pre></div></div>
<p>A little bit of geographical knowledge tells us the county names are stored in the column
named <code class="language-plaintext highlighter-rouge">subregion</code>, and they are all lower-case while without the trailing “County” as in <code class="language-plaintext highlighter-rouge">zip_sub</code>!
To match this, we make some changes to the column storing county names in <code class="language-plaintext highlighter-rouge">zip_sub</code>:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">zip_sub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">zip_sub</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># extract county names and set the first latter to lower case</span><span class="w">
  </span><span class="c1"># assign these values to the column 'subregion'</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">subregion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_split_i</span><span class="p">(</span><span class="n">county</span><span class="p">,</span><span class="w"> </span><span class="s2">" "</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
         </span><span class="n">subregion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_to_lower</span><span class="p">(</span><span class="n">subregion</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">county</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now, we are ready to merge <code class="language-plaintext highlighter-rouge">zip_sub</code> with <code class="language-plaintext highlighter-rouge">zip_sum</code>, which yield each patient’s county of origin;
and then we merge this combined data frame with <code class="language-plaintext highlighter-rouge">nc</code>, adding the map coordinates for counties:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pt_zip_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">zip_sum</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">zip_sub</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"zip"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">right_join</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"subregion"</span><span class="p">,</span><span class="w"> </span><span class="n">relationship</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"many-to-many"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>This prompts many missing values <code class="language-plaintext highlighter-rouge">NA</code> since we do not have any patient from the majority of counties.
To deal with this, we just replace the missing value with 0:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pt_zip_counts</span><span class="o">$</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">replace_na</span><span class="p">(</span><span class="n">pt_zip_counts</span><span class="o">$</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>The following steps are also not mandatory: we replace any count of patients from a zipcode
above the 95-th percentile of all counts to the 95-th percentile value to get a better dynamic range
of colors - this way low counts like 1 would be clearly visualized as well.</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pt_zip_counts</span><span class="o">$</span><span class="n">n_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pt_zip_counts</span><span class="o">$</span><span class="n">n</span><span class="w">
</span><span class="n">pt_zip_counts</span><span class="o">$</span><span class="n">n_plot</span><span class="p">[</span><span class="n">pt_zip_counts</span><span class="o">$</span><span class="n">n_plot</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">pt_zip_counts</span><span class="o">$</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">.95</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">pt_zip_counts</span><span class="o">$</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">.95</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>A final check of the data frame (<code class="language-plaintext highlighter-rouge">head(pt_zip_count, 2)</code>) shows the followings:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 2 × 9
  zip       n subregion   long   lat group order region         n_plot
  &lt;chr&gt; &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;           &lt;dbl&gt;
1 27025     2 rockingham -80.0  36.5  1937 57960 north carolina      2
2 27025     2 rockingham -79.7  36.5  1937 57961 north carolina      2
</code></pre></div></div>

<p>Now, we dish up the plot using <code class="language-plaintext highlighter-rouge">geom_polygon</code> from <code class="language-plaintext highlighter-rouge">ggplot</code>:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">S</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt_zip_counts</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_polygon</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_plot</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_viridis_c</span><span class="p">(</span><span class="s2">"Patient count"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">legend.position</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">.2</span><span class="p">,</span><span class="m">.15</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_colorbar</span><span class="p">(</span><span class="n">barwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="n">title.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"top"</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"horizontal"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<p>Saving it using the following line (you can substitute the file path with whatever you like):</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggsave</span><span class="p">(</span><span class="s2">"patient_origin_map.png"</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9.5</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3.5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>We have the final product shown at the beginning of the page!</p>

<p>Thanks for reading! I hope you have learned a lot and enjoyed this content. Have questions
or suggestions? Feel free to email me through the Contact page.</p>
  </section>

  
  
  

  <section class="background" data-size="page">
    <!--
  background: ;
  dark: ;
  size: ;
-->


<div class="post-nav">
  <span>
    
      <i class="icon fa-solid fa-angle-left"></i> Previous post<br>
      <a href="/2023/02/23/example-post-3.html">
        I Love Trying New Things
      </a>
    
  </span>
  <span>
    
  </span>
</div>
  </section>


    </main>
    


<footer class="background" style="--image: url('/images/header.jpg')" data-dark="true" data-size="wide">
  <!--
    <div>
      Extra details like contact info or address
    </div>
  -->

  <div>
    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="mailto:tianyi96@live.unc.edu" data-tooltip="Email" data-style="bare" aria-label="Email">
      <i class="icon fa-solid fa-envelope"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://orcid.org/0000-0002-2484-2478" data-tooltip="ORCID" data-style="bare" aria-label="ORCID">
      <i class="icon fa-brands fa-orcid"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://scholar.google.com/citations?user=rgq62U4AAAAJ" data-tooltip="Google Scholar" data-style="bare" aria-label="Google Scholar">
      <i class="icon fa-brands fa-google"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://github.com/gr8lawrence" data-tooltip="GitHub" data-style="bare" aria-label="GitHub">
      <i class="icon fa-brands fa-github"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://twitter.com/gr8lawrence" data-tooltip="Twitter" data-style="bare" aria-label="Twitter">
      <i class="icon fa-brands fa-twitter"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://www.linkedin.com/in/tianyi-liu-157874133" data-tooltip="LinkedIn" data-style="bare" aria-label="LinkedIn">
      <i class="icon fa-brands fa-linkedin"></i>
      
    </a>
  </div>


    
  </div>

  <div>
    © 2023
    Tianyi Liu
      |   Built with
    <a href="https://github.com/greenelab/lab-website-template">
      Lab Website Template
    </a>
  </div>

  <input type="checkbox" class="dark-toggle" data-tooltip="Dark mode" aria-label="toggle dark mode" oninput="onDarkToggleChange(event)">
</footer>

  </body>
</html>
